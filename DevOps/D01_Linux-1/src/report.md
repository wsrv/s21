# Операционные системы UNIX/Linux (Базовый).

Установка и обновления системы Linux. Основы администрирования.


## Contents
1. [Установка ОС](#part-1-установка-ос)  
2. [Создание пользователя](#part-2-создание-пользователя)  
3. [Настройка сети ОС](#part-3-настройка-сети-ос)   
4. [Обновление ОС](#part-4-обновление-ос)  
5. [Использование команды  sudo](#part-5-использование-команды-sudo)  
6. [Установка и настройка службы времени](#part-6-установка-и-настройка-службы-времени)  
7. [Установка и использование текстовых редакторов](#part-7-установка-и-использование-текстовых-редакторов)  
8. [Установка и базовая настройка сервиса SSHD](#part-8-установка-и-базовая-настройка-сервиса-sshd)   
9. [Установка и использование утилит top, htop](#part-9-установка-и-использование-утилит-top-htop)   
10. [Использование утилиты fdisk](#part-10-использование-утилиты-fdisk)   
11. [Использование утилиты df](#part-11-использование-утилиты-df)    
12. [Использование утилиты du](#part-12-использование-утилиты-du)    
13. [Установка и использование утилиты ncdu](#part-13-установка-и-использование-утилиты-ncdu)    
14. [Работа с системными журналами](#part-14-работа-с-системными-журналами)     
15. [Использование планировщика заданий CRON](#part-15-использование-планировщика-заданий-cron)    

---

## Part 1. Установка ОС
**Задание:**
*Установить Ubuntu 20.04 Server LTS без графического интерфейса. (Используем программу для виртуализации - VirtualBox)*
- *Графический интерфейс должен отсутствовать.*
- *Узнайте версию Ubuntu, выполнив команду*
*`cat /etc/issue`*
- *Вставьте скриншот с выводом команды.*

---

- Устанавливаем и запускаем Linux при помощи VirtualBox:

<img src="src/screenshots/1.0.png" width="700">

- Проверяем версию Ubuntu, выполнив команду `cat /etc/issue`

<img src="src/screenshots/1.1.png" width="500">



## Part 2. Создание пользователя
**Задание:**
*Создать пользователя, отличного от пользователя, который создавался при установке. Пользователь должен быть добавлен в группу `adm`.*
- *Вставьте скриншот вызова команды для создания пользователя.*
- *Новый пользователь должен быть в выводе команды `cat /etc/passwd`*
- *Вставьте скриншот с выводом команды.*

---

- Добавим нового пользователя `anotheruser` про помощи команды `useradd` и при помощи флага `-G` сразу добавим его в группу `adm`. Чтобы проверить действительно ли пользователь добавлен в группу используем команду `groups`

<img src="src/screenshots/2.1.png" width="700">

- С помощью команды `cat /etc/passwd` убедимся, что этот пользователь действительно добавлен (он отображается последним).

<img src="src/screenshots/2.2.png" width="700">

## Part 3. Настройка сети ОС
**Задание:**
* *Задать название машины вида user-1*
* *Установить временную зону, соответствующую вашему текущему местоположению.*
* *Вывести названия сетевых интерфейсов с помощью консольной команды.*
*(В отчёте дать объяснение наличию интерфейса lo.)*
* *Используя консольную команду получить ip адрес устройства, на котором вы работаете, от DHCP сервера.*
*(В отчёте дать расшифровку DHCP.)*
* *Определить внешний ip-адрес шлюза (ip) и внутренний IP-адрес шлюза, он же ip-адрес по умолчанию (gw).*
* *Задать статичные (заданные вручную, а не полученные от DHCP сервера) настройки ip, gw, dns (использовать публичный DNS серверы, например 1.1.1.1 или 8.8.8.8).*
* *Перезагрузить виртуальную машину. Убедиться, что статичные сетевые настройки (ip, gw, dns) соответствуют заданным в предыдущем пункте.*

> *В отчёте опишите, что сделали для выполнения всех семи пунктов (можно как текстом, так и скриншотами).*
> *Успешно пропинговать удаленные хосты 1.1.1.1 и ya.ru и вставить в отчёт скрин с выводом команды. В выводе команды должна быть фраза "0% packet loss".*

---

- С помощью команды `hostnamectl set-hostname user-1` задаем название машины вида user-1.

<img src="src/screenshots/3.1.png" width="700">

- Установливаем временную зону, соответствующую вашему текущему местоположению. `Asia/Novosibirsk` и проверяем что время действительно установилось через команду `timedatectl`

<img src="src/screenshots/3.2.png" width="700">

- Через команду `ip link show` выводим названия сетевых интерфейсов (lo - интерфейс локальной петли, который служит для подключения по сети к этому же компьютеру, enp0s3 - наша виртуальная машина)

<img src="src/screenshots/3.3.png" width="700">

- Получить выданный DHCP (сетевой протокол динамической настройки узла, позволяющий сетевым устройствам автоматически получать IP-адрес и другие параметры, необходимые для работы в сети) ip адрес устройства, на котором мы работаем.

<img src="src/screenshots/3.4.1.png" width="700">

- Определяем внешний ip-адрес шлюза (ip) и внутренний IP-адрес шлюза (gw).

<img src="src/screenshots/3.4e.png" width="700">(внешний)

<img src="src/screenshots/3.4y.png" width="700">(внутренний)

- Задаем статичные настройки ip, gw, dns при помощи редактирование файла `/etc/netplan/00-installer-config.yaml`.

<img src="src/screenshots/3.6.png" width="700">

- Перезагружаем виртуальную машину.

<img src="src/screenshots/3.7.png" width="700">

- Проверяем приминились ли прописанные ранее настройки.

<img src="src/screenshots/3.7.2.png" width="700">

- Пропингуем удаленные хосты 1.1.1.1 и ya.ru.

<img src="src/screenshots/ping.png" width="700">

## Part 4. Обновление ОС
**Задание**
- *Обновить системные пакеты до последней на момент выполнения задания версии.*  
- *После обновления системных пакетов, если ввести команду обновления повторно, должно появится сообщение, что обновления отсутствуют.*
- *Вставить скриншот с этим сообщением в отчёт.*

---

- При помощи команды `apt-get upgrade` обновим системные пакеты (они уже все обновлены, так как сразу появляется сообщение, что обновления отсутствуют).

<img src="src/screenshots/4.png" width="700">


## Part 5. Использование команды **sudo**
**Задание**
- *Разрешить пользователю, созданному в [Part 2](#part-2-создание-пользователя), выполнять команду sudo.*
- *В отчёте объяснить *истинное* назначение команды sudo (про то, что это слово - "волшебное", писать не стоит).*
- *Поменять hostname ОС от имени пользователя, созданного в пункте [Part 2](#part-2-создание-пользователя) (используя sudo).*
- *Вставить скрин с изменённым hostname в отчёт.*

---

Добавляем пользователя `anotheruser` в группу `sudo`.
Переключаемся на пользователя `anotheruser`.
Проверяем работает ли `sudo` через вывод содержимого папки `root`.

<img src="src/screenshots/5.png" width="700">

## Part 6. Установка и настройка службы времени
**Задание**
- *Настроить службу автоматической синхронизации времени.*
- *Вывести время, часового пояса, в котором вы сейчас находитесь.*
- *Вывод следующей команды должен содержать `NTPSynchronized=yes`: \
  *`timedatectl show`*
- *Вставить скрины с корректным временем и выводом команды в отчёт.*

---

Подключаем синхронизацию времени с помощью команды `timedatectl set-ntp true` и вводим требуемую в задании команду `timedatectl show`

<img src="src/screenshots/6.png" width="700">


## Part 7. Установка и использование текстовых редакторов 
**Задание**

Установить текстовые редакторы VIM, NANO, MCEDIT.
- *Используя каждый из трех выбранных редакторов, создайте файл *test_X.txt*, где X -- название редактора, в котором создан файл. Напишите в нём свой никнейм, закройте файл с сохранением изменений.*
 - *В отчёт вставьте скриншоты:*
   - *Из каждого редактора с содержимым файла перед закрытием.*
 - *В отчёте укажите, что сделали для выхода с сохранением изменений.*
- *Используя каждый из трех выбранных редакторов, откройте файл на редактирование, отредактируйте файл, заменив никнейм на строку "21 School 21", закройте файл без сохранения изменений.*
 - *В отчёт вставьте скриншоты:*
    - *Из каждого редактора с содержимым файла после редактирования.*
 - *В отчёте укажите, что сделали для выхода без сохранения изменений.*
- *Используя каждый из трех выбранных редакторов, отредактируйте файл ещё раз (по аналогии с предыдущим пунктом), а затем освойте функции поиска по содержимому файла (слово) и замены слова на любое другое.*
 - *В отчёт вставьте скриншоты:*
    - *Из каждого редактора с результатами поиска слова.*
    - *Из каждого редактора с командами, введёнными для замены слова на другое.*

---

* Создаем файл `test_vim.txt` (через команду `vim test_vim.txt`) и открываем его для редактирования, вводим команду `i` и записываем туда ник `roddstat`

<img src="src/screenshots/vim1.png" width="700">

* Нажимаем `esc` и сохраняем файл после редактирования с помощью ввода `:w`

<img src="src/screenshots/vim2.png" width="700">

* Выходим через ввод команды `:q`

<img src="src/screenshots/vim3.png" width="700">

* Аналогично снова открываем тот же файл и редактируем его меняя `roddstat` на `21 School_21`

<img src="src/screenshots/vim4.png" width="700">

* Закрываем без сохранения через команду `:q!`

<img src="src/screenshots/vim5.png" width="700">

* Повторно открываем файл для того, чтобы проверить что мы вышли без сохранения

<img src="src/screenshots/vim6.png" width="700">

* Cнова открываем файл и редактируем его через поиск и замену строки (команда `:s/слово которое хотим заменить/слово, которым хотим заменить`)

<img src="src/screenshots/vim7.png" width="700">

* Результат после замены 

<img src="src/screenshots/vim8.png" width="700">


---


* Создаем файл `test_nano.txt` (через команду `nano test_nano.txt`) и открываем его для редактирования, записываем туда ник `roddstat`

<img src="src/screenshots/nano1.png" width="700">

* Нажимаем `control + o` и сохраняем файл после редактирования (нажимаем `enter` чтобы сохранить изменения в файле с тем же именем). Выходим через ввод команды `control + x`

<img src="src/screenshots/nano2.png" width="700">

* Аналогично снова открываем тот же файл и редактируем его меняя `roddstat` на `21 School_21`
Закрываем без сохранения через команды `control + x`, `n` (закрываем и при вопросе от редактора сохранить ли изменения выбираем нет)

<img src="src/screenshots/nano3.png" width="700">

* Повторно открываем файл для того, чтобы проверить что мы вышли без сохранения

<img src="src/screenshots/nano4.png" width="700">

* Cнова открываем файл и редактируем его через поиск и замену строки (команды ` control + \`, `слово которое хотим заменить`, `enter`, `слово, которым хотим заменить`, `enter`, `y`)

<img src="src/screenshots/nano5.png" width="700">

<img src="src/screenshots/nano6.png" width="700">

<img src="src/screenshots/nano7.png" width="700">

* Сохраняем, выходим и открываем заново, чтобы убедиться, что все сработоло

<img src="src/screenshots/nano8.png" width="700">


---


* Создаем файл `test_mcedit.txt` (через команду `mcedit test_mcedit.txt`) и открываем его для редактирования, записываем туда ник `roddstat`

<img src="src/screenshots/mc1.png" width="700">

* Cохраняем файл после редактирования с помощью ввода `fn + F2`, `enter`. Выходим через ввод команды `fn + F10`

<img src="src/screenshots/mc2.png" width="700">

* Аналогично снова открываем тот же файл и редактируем его меняя `roddsta` на `21 School 21`. Выходим через ввод команды `fn + F10` и когда редактор спросит нужно ли сохранять выбираем `no`

<img src="src/screenshots/mc3.png" width="700">

* Повторно открываем файл для того, чтобы проверить что мы вышли без сохранения

<img src="src/screenshots/mc4.png" width="700">

* Cнова открываем файл и редактируем его через поиск и замену строки (команда `fn + F4`)

<img src="src/screenshots/mc5.png" width="700">

<img src="src/screenshots/mc6.png" width="700">


<img src="src/screenshots/mc7.png" width="700">

* Выходим и повторно открываем файл, чтобы убедиться что все прошло успешно 

<img src="src/screenshots/mc8.png" width="700">

## Part 8. Установка и базовая настройка сервиса **SSHD**
**Задание**

* *Установить службу SSHd.*
* *Добавить автостарт службы при загрузке системы.*
* *Перенастроить службу SSHd на порт 2022.* 
* *Используя команду ps, показать наличие процесса sshd. Для этого к команде нужно подобрать ключи.*
   * *В отчёте объяснить значение команды и каждого ключа в ней.*
* *Перезагрузить систему.*
* *В отчёте опишите, что сделали для выполнения всех пяти пунктов (можно как текстом, так и скриншотами).*
   * *Вывод команды `netstat -tan` должен содержать `tcp 0 0 0.0.0.0:2022 0.0.0.0:* LISTEN` (если команды netstat нет, то ее нужно установить)*
   * *Скрин с выводом команды вставить в отчёт.*
   * *В отчёте объяснить значение ключей -tan, значение каждого столбца вывода, значение 0.0.0.0.*

---

* Установим службу SSHd. 

<img src="src/screenshots/8.1.png" width="700">

* Добавим автостарт службы при загрузке системы.

<img src="src/screenshots/8.2.png" width="700">

* Перенастроим службу SSHd на порт 2022 с помощью редактирования файла `/etc/ssh/sshd_config.d/*.config` 

<img src="src/screenshots/8.3.png" width="700">


* Через команду `pidof` найдем ip адресса процеесов `sshd` и передадим их в команду `ps`. Чтобы убедиться что `sshd` действительно запущен. (`PID`- идентификатор процесса, `TTY`- терминал, из которого запущен процесс, `STAT`- состояние, в котором на данный момент находится процесс, `TIME`- oбщее процессорное время, затраченное на выполнение процесса, `COMMAND`- команда запуска процессора)

<img src="src/screenshots/8.4.png" width="700">

* Вывод команды `netstat -tan` (который должен содержать `tcp 0 0 0.0.0.0:2022 0.0.0.0:* LISTEN`) 
(`-t`- перечислить все TCP порты, `-a`- перечислить все порты, `-n`- отображение имен, `Proto`- прооткол, `Recv-Q`- количество запросов в очередях на приём на данном узле/компьютере, `Send-Q`- количество запросов в очередях на отправку на данном узле/компьютере, `Local Address`- IP-адрес локального компьютера и номер используемого порта, `Foreign Address`- имя сервера или IP-адрес, с которым устанавливается соединение, `State`- указывает состояние TCP-соединения.,`0.0.0.0.*`- это специальный IP-адрес, известный как «маршрут по умолчанию» или «неуказанный адрес» . Он используется для указания того, что трафик должен отправляться на все интерфейсы машины, независимо от их индивидуальных IP-адресов)

<img src="src/screenshots/8.5.png" width="700">

## Part 9. Установка и использование утилит **top**, **htop**
**Задание**
 *Установить и запустить утилиты top и htop.*  
- *По выводу команды top определить и написать в отчёте:*
  - *uptime*
  - *количество авторизованных пользователей*
  - *общую загрузку системы*
  - *общее количество процессов*
  - *загрузку cpu*
  - *загрузку памяти*
  - *pid процесса занимающего больше всего памяти*
  - *pid процесса, занимающего больше всего процессорного времени*
- *В отчёт вставить скрин с выводом команды htop:*
  - *отсортированному по PID, PERCENT_CPU, PERCENT_MEM, TIME*
  - *отфильтрованному для процесса sshd*
  - *с процессом syslog, найденным, используя поиск*
  - *с добавленным выводом hostname, clock и uptime*

---

 * Установить и запустить утилиты top и htop.

 <img src="src/screenshots/9.1.png" width="700">

  - *uptime* - `1:25`
  - *количество авторизованных пользователей* - `1 user`
  - *общую загрузку системы* - `0.0`
  - *общее количество процессов* - `109`
  - *загрузку cpu* - `0.2`
  - *загрузку памяти* - `205.8`
  - *pid процесса занимающего больше всего памяти* - `1720` (`shift + m`)
<img src="src/screenshots/9.2.png" width="700">

  - *pid процесса, занимающего больше всего процессорного времени* - `644` (`shift+t`)
<img src="src/screenshots/9.3.png" width="700">

- *В отчёт вставить скрин с выводом команды htop:*
  - *отсортированному по PID, PERCENT_CPU, PERCENT_MEM, TIME*

  * PID:

<img src="src/screenshots/9.4.png" width="700">

  * PERCENT_CPU:

<img src="src/screenshots/9.5.png" width="700">

  * PERCENT_MEM:

<img src="src/screenshots/9.6.png" width="700">

  * TIME:

<img src="src/screenshots/9.7.png" width="700"> 

  - *отфильтрованному для процесса sshd*

<img src="src/screenshots/9.8.png" width="700"> 

  - *с процессом syslog, найденным, используя поиск*

  <img src="src/screenshots/9.9.png" width="900"> 

  - *с добавленным выводом hostname, clock и uptime*

  <img src="src/screenshots/9.10.png" width="700"> 

## Part 10. Использование утилиты **fdisk**
**Задание**
- *Запустить команду `fdisk -l`.*
- *В отчёте написать название жесткого диска, его размер и количество секторов.*

---

- Результат команды `fdisk -l`.
  <img src="src/screenshots/10.1.png" width="700"> 

- Название жесткого диска `sda`, его размер `16Gb`, количество секторов `33554432`.

## Part 11. Использование утилиты **df** 
**Задание**
* *Запустить команду df.*  
- *В отчёте написать для корневого раздела (/):*
  - *размер раздела*
  - *размер занятого пространства*
  - *размер свободного пространства*
  - *процент использования*
- *Определить и написать в отчёт единицу измерения в выводе.*  
* *Запустить команду df -Th.*
- *В отчёте написать для корневого раздела (/):*
    - *размер раздела*
    - *размер занятого пространства*
    - *размер свободного пространства*
    - *процент использования*
- *Определить и написать в отчёт тип файловой системы для раздела.*

---

* *Запустить команду df.*  

  <img src="src/screenshots/11.1.png" width="700"> 

- Для корневого раздела (/):
  - размер раздела `16400252`
  - размер занятого пространства `6115080`
  - размер свободного пространства `9430084`
  - процент использования `40`
  - единицу измерения в выводе `килобайты` 
* Запустить команду df -Th.
- В отчёте написать для корневого раздела (/):
  - размер раздела `16 Gb`
  - размер занятого пространства `5.9Gb`
  - размер свободного пространства `9 Gb`
  - процент использования `40%`
  - Tип файловой системы `ext4`

## Part 12. Использование утилиты **du**
**Задание**
- *Запустить команду du.*
- *Вывести размер папок /home, /var, /var/log (в байтах, в человекочитаемом виде)*
- *Вывести размер всего содержимого в /var/log (не общее, а каждого вложенного элемента, используя *)*
- *В отчёт вставить скрины с выводом всех использованных команд.*

---

- Запустим команду du.

  <img src="src/screenshots/12.1.png" width="700"> 

- Выведем размер папок /home, /var, /var/log (в человекочитаемом виде)

  <img src="src/screenshots/12.2.png" width="700"> 

- Выведем размер папок /home, /var, /var/log (в байтах)

  <img src="src/screenshots/12.3.png" width="700"> 

- Выведем размер всего содержимого в /var/log (не общее, а каждого вложенного элемента, используя *)

  <img src="src/screenshots/12.4.png" width="700"> 

## Part 13. Установка и использование утилиты **ncdu**
**Задание**
- *Установить утилиту ncdu.*
- *Вывести размер папок /home, /var, /var/log.*
- *В отчёт вставить скрины с выводом использованных команд.*

---

- Установим утилиту ncdu.

  <img src="src/screenshots/13.1.png" width="700"> 

- Выведем размер папок /home 

  <img src="src/screenshots/13.2.png" width="700"> 

- Выведем размер папок /var 

  <img src="src/screenshots/13.3.png" width="700"> 

- Выведем размер папок /var/log

  <img src="src/screenshots/13.4.png" width="700"> 

## Part 14. Работа с системными журналами
**3адание**
 *Открыть для просмотра:*
 1. */var/log/dmesg*
 2. */var/log/syslog*
 3. */var/log/auth.log* 
- *Написать в отчёте время последней успешной авторизации, имя пользователя и метод входа в систему.*
- *Перезапустить службу SSHd.*
- *Вставить в отчёт скрин с сообщением о рестарте службы (искать в логах).*

---

 Откроем для просмотра:
 1. `/var/log/dmesg` (`less /var/log/dmesg`)

   <img src="src/screenshots/14.1.png" width="700"> 

 2. `/var/log/syslog` (`less /var/log/syslog`)

   <img src="src/screenshots/14.2.png" width="700"> 

 3. `/var/log/auth.log` (`less /var/log/auth.log`)

   <img src="src/screenshots/14.3.png" width="700"> 

- Bремя последней успешной авторизации, имя пользователя и метод входа в систему (`sudo grep -ai LOGIN /var/log/auth.log`)

   <img src="src/screenshots/14.4.png" width="700"> 

- Перезапустим службу SSHd. (`sudo systemctl restart sshd`)
- Cкрин с сообщением о рестарте службы (найден в логах `sudo grep -a restart /var/log/auth.log`).

   <img src="src/screenshots/14.5.png" width="700"> 

## Part 15. Использование планировщика заданий **CRON**
**Задание**
*Используя планировщик заданий, запустите команду uptime через каждые 2 минуты.*
- *Найти в системных журналах строчки (минимум две в заданном временном диапазоне) о выполнении.*
- *Вывести на экран список текущих заданий для CRON.*
- *Вставить в отчёт скрины со строчками о выполнении и списком текущих задач.*
*Удалите все задания из планировщика заданий.*
- *В отчёт вставьте скрин со списком текущих заданий для CRON.*

---

- Используя планировщик заданий `CRON` (`crontab -e`), запустим команду uptime через каждые 2 минуты.

   <img src="src/screenshots/15.1.png" width="700"> 

- Найдем в системных журналах строчки о выполнении (`sudo grep CRON /var/log/syslog`).

   <img src="src/screenshots/15.2.png" width="700"> 

- Выведем на экран список текущих заданий для CRON(`crontab -l`)

   <img src="src/screenshots/15.3.png" width="700"> 

- Удалим все задания из планировщика заданий.

   <img src="src/screenshots/15.4.png" width="700"> 

- Скрин со списком текущих заданий для CRON.

   <img src="src/screenshots/15.5.png" width="700"> 

